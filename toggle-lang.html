<div id="lang-slider-container"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const currentPath = window.location.pathname;
  const isSpanish = currentPath.includes("/es/");
  const navbar = document.querySelector(".navbar") || document.body;

  const container = document.getElementById("lang-slider-container");
  const slider = document.createElement("div");
  slider.className = "lang-slider";

  const knob = document.createElement("div");
  knob.className = "lang-knob";

  const esLabel = document.createElement("span");
  esLabel.textContent = "Es ";
  esLabel.className = "lang-label es";

  const enLabel = document.createElement("span");
  enLabel.textContent = "En";
  enLabel.className = "lang-label en";

  slider.appendChild(esLabel);
  slider.appendChild(enLabel);
  slider.appendChild(knob);
  container.appendChild(slider);
  navbar.appendChild(container);

  // Estado inicial
  if (!isSpanish) slider.classList.add("right");

  let startX = 0;
  let dragging = false;

  const goTo = (lang) => {
    if (lang === "es" && !isSpanish)
      window.location.href = currentPath.replace("/en/", "/es/");
    if (lang === "en" && isSpanish)
      window.location.href = currentPath.replace("/es/", "/en/");
  };

  // Eventos touch + mouse
  const onStart = (e) => {
    dragging = true;
    startX = e.touches ? e.touches[0].clientX : e.clientX;
  };
  const onMove = (e) => {
    if (!dragging) return;
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    const delta = x - startX;
    if (delta > 20) slider.classList.add("right");
    if (delta < -20) slider.classList.remove("right");
  };
  const onEnd = () => {
    dragging = false;
    if (slider.classList.contains("right")) goTo("en");
    else goTo("es");
  };

  knob.addEventListener("mousedown", onStart);
  knob.addEventListener("touchstart", onStart);
  window.addEventListener("mousemove", onMove);
  window.addEventListener("touchmove", onMove);
  window.addEventListener("mouseup", onEnd);
  window.addEventListener("touchend", onEnd);
});
</script>

<style>
#lang-slider-container {
  display: inline-block;
  margin-left: 1em;
}

.lang-slider {
  position: relative;
  width: 130px;
  height: 30px;
  background: #f1f1f1;
  border-radius: 20px;
  border: 1px solid #ccc;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 10px;
  font-size: 0.85em;
  user-select: none;
  transition: background 0.3s;
}

.lang-slider .lang-label {
  z-index: 2;
  color: #555;
  flex: 1;
  text-align: center;
  pointer-events: none;
}

.lang-slider .lang-knob {
  position: absolute;
  width: 60px;
  height: 26px;
  border-radius: 18px;
  background: #007bff;
  top: 2px;
  left: 2px;
  transition: all 0.25s ease;
  z-index: 1;
}

.lang-slider.right .lang-knob {
  left: calc(100% - 62px);
  background: #007bff;
}

.lang-slider.right .lang-label.en {
  color: white;
}
.lang-slider:not(.right) .lang-label.es {
  color: white;
}

.lang-slider.right {
  background: #e8e8e8;
}

.lang-slider .lang-label {
  transition: color 0.3s;
}

@media (max-width: 768px) {
  .lang-slider {
    width: 110px;
    height: 28px;
  }
  .lang-slider .lang-knob {
    width: 52px;
    height: 24px;
  }
}
</style>
